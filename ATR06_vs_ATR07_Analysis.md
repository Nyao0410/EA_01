# ATR06 問題分析 & ATR07 改善戦略

## ATR06の問題点

### 📊 バックテスト結果
- **取引数：0回** ⚠️⚠️⚠️
- **総損益：0.00**
- **期待利得：0.00**

### 🔍 根本原因分析

#### **1. ボラティリティ確認フィルターが厳しすぎ**

```
条件：ATR > 平均ATR × 1.2倍

問題：
- EURUSD日足では平均ATRがそもそも大きい
- 1.2倍条件は非常に稀
- ほぼ全ての取引チャンスが排除される
```

**改善**：
- ✅ ボラティリティ確認フィルターをオプション化（デフォルト無効）
- ✅ 閾値を1.0倍に緩和（実装時のみ）

---

#### **2. 時間フィルターが地理的に適切でない**

```
設定：GMT 8-20時のみ取引

問題：
- EURUSDはロンドン・ニューヨークセッション主体
- 日足チャートなので「営業時間」概念が無意味
- 事実上、ほぼ全てのキャンドルが対象外
```

**改善**：
- ✅ 時間フィルター完全無効化（`UseTimeFilter = false`）
- ✅ 24時間取引可能に

---

#### **3. RSI極値フィルターが不適切**

```
ATR06設定：RSI 30-70範囲内のみ取引

問題：
- このレンジはほぼ全てのトレンド相場をカバー
- トレンドの開始局面（RSI < 30 or > 70）を排除
- 「レンジ相場」にのみ限定されている
- 実際の市場では RSI 20-80 程度が一般的
```

**改善**：
- ✅ RSI 20-80に緩和（より寛容）
- ✅ 極度の過買い/過売りのみ回避

---

#### **4. 複数フィルターの組み合わせの過度性**

```
ATR06では以下の全てを満たす必要がある：
1. ATR > 30 pips ✓
2. ATR > 平均ATR × 1.2倍 ✗ ← 厳しすぎ
3. トレンドフィルター ✓
4. RSI 30-70 ✗ ← 厳しすぎ
5. 営業時間 8-20時 ✗ ← 無意味

結果：
- AND条件なので全て同時に満たす必要
- 確率的にほぼ不可能
```

---

## ATR07の改善戦略

### 🎯 設計方針：バランス型

```
ATR05：取引数多い（34回）が、勝率低い（41%）
  ↓
ATR06：フィルター多い（0回）が、品質高い（取引なし）
  ↓
ATR07：取引機会 × 安定性のバランス
```

### 📋 具体的な改善

#### **A. フィルター構成の最適化**

| 項目 | ATR05 | ATR06 | ATR07 | 説明 |
|------|-------|-------|-------|------|
| **ATR最小値** | 28.0 | 30.0 | **20.0** | ↓ 機会確保 |
| **ボラティリティ確認** | 無 | 有（1.2倍） | **無（オプション）** | ↓ 柔軟性 |
| **時間フィルター** | 無 | 有（8-20h） | **無** | ✓ 合理的 |
| **RSI範囲** | 25-75 | 30-70 | **20-80** | ↓ 寛容性向上 |
| **トレンドフィルター** | 有 | 有 | **有** | ✓ 継続 |

#### **B. リスク管理の調整**

| 項目 | ATR05 | ATR06 | ATR07 | 理由 |
|------|-------|-------|-------|------|
| **リスク率** | 0.3% | 0.25% | **0.25%** | 継続 |
| **リワード倍率** | 1.5x | 2.0x | **1.75x** | 現実的 |
| **連敗閾値** | 2回 | 1回 | **2回** | 柔軟性 |
| **ロット削減** | 67% | 50% | **67%** | バランス |
| **復帰勝数** | 3勝 | 3勝 | **2勝** | 迅速性 |
| **日次制限** | 2.0% | 1.5% | **1.5%** | 継続 |

---

### 💡 パラメータの詳細説明

#### **1. MinATRFilter = 20.0**

```
理由：
- ATR05と同じレベルに戻す
- 20-30 pipsのボラティリティでも取引可能
- 機会の確保が最優先

効果：
- ATR05の取引数（34回）程度を期待
- フィルターなしで全取引の候補をキャッチ
```

#### **2. UseVolatilityConfirmation = false**

```
理由：
- 日足での営業時間フィルターは無意味
- ボラティリティ確認は極稀な相場環境のみ
- 取引機会喪失が大きすぎる

選択肢：
- false（デフォルト）：全取引対象
- true：平均ATR以上の環境のみ（検証用）
```

#### **3. UseTimeFilter = false**

```
理由：
- 日足は「時間帯」という概念がない
- 1キャンドル = 1日なので営業時間意味なし
- 時間足を使う場合のみ有効

推奨：
- 日足 → false（デフォルト）
- 4時間足以下 → true で GMT 8-20時推奨
```

#### **4. RSIUpperLevel = 80 / RSILowerLevel = 20**

```
理由：
- 30-70は「トレンド相場排除」になる
- 20-80は「極度の過買い/過売り防止」
- トレンドの開始段階をキャッチ可能

効果：
- より多くのシグナルをキャッチ
- トレンドの初期段階で乗れる
```

#### **5. RewardMultiplier = 1.75**

```
計算例：
ATR = 100 pips

ATR06（2.0倍）：
- SL距離 = 150 pips
- TP距離 = 300 pips
- RR比 1:2.0

ATR07（1.75倍）：
- SL距離 = 150 pips
- TP距離 = 262 pips
- RR比 1:1.75

理由：
- ATR06は理想的だが達成困難
- ATR07は現実的で達成可能
- ATR05の1.5倍より高い効率
```

#### **6. MaxConsecutiveLosses = 2**

```
ATR05：2連敗でロット削減（67%）
ATR06：1連敗でロット削減（50%）
ATR07：2連敗でロット削減（67%）← バランス

理由：
- 1連敗では過度に反応しない
- 2連敗で保守的に対応
- 単発の損失に過剰反応しない
```

---

## 📈 期待される改善結果

### 比較表

| 指標 | ATR05 | ATR06 | ATR07予想 | 改善度 |
|------|-------|-------|-----------|--------|
| **取引数** | 34 | 0 | **25-35** | ✓ ATR05並 |
| **勝率** | 41.18% | - | **43-45%** | ↑ 向上 |
| **PF** | 0.98 | - | **1.05-1.15** | ↑ 改善 |
| **ドローダウン** | 2.53% | - | **1.8-2.3%** | ↓ 改善 |
| **期待利得** | -0.34 | - | **+0.5～+1.0** | ↑ 改善 |

### 🎯 ATR07の強み

```
✅ ATR05の取引機会を維持
✅ ATR06のフィルター安定性を一部採用
✅ 現実的なパラメータセット
✅ 極度な設定なし（過適合リスク低い）
✅ 解釈可能でテスト結果の信頼性高い
```

---

## 🚀 次のステップ

### 1. バックテスト実施
```
期間：2023.01.01 - 2024.10.20（ATR05と同期間）
期待結果：
- 取引数：25-35回
- 勝率：43-45%
- プロフィットファクター：1.05-1.15
```

### 2. パラメータ微調整の検討
```
必要に応じて以下を調整：
- MinATRFilter：20 → 18-25の範囲
- RSI levels：20-80 → 15-85の検証
- RewardMultiplier：1.75 → 1.5-2.0の検証
```

### 3. パフォーマンス分析
```
以下を確認：
- 月別の勝率推移
- 最大連敗数
- ドローダウン推移
- 時間帯別の成績
```

---

## 📊 設定値の根拠

### 参照：ATR05成績（実績）

```
取引数：34
勝率：41.18%（14勝20敗）
平均勝ち：34.87
平均負け：-24.99
最大連敗：4回
ドローダウン：2.53%
```

### 目標：ATR07の改善方向

```
取引数：30前後（質を高める）
勝率：45%以上（3-4%向上目標）
平均勝ち：35程度（維持）
平均負け：-22程度（3pips改善）
最大連敗：2-3回（制御強化）
ドローダウン：2.0%以下（20%削減）
```

---

## ⚙️ 実装変更箇所

```mq5
// ATR06 → ATR07 の主要変更

1. MinATRFilter
   30.0 → 20.0

2. UseVolatilityConfirmation
   true → false

3. RewardMultiplier
   2.0 → 1.75

4. RSIUpperLevel / RSILowerLevel
   70.0 / 30.0 → 80.0 / 20.0

5. MaxConsecutiveLosses
   1 → 2

6. LotReductionPercent
   0.5 → 0.67

7. WinCountToRestore
   3 → 2

8. UseTimeFilter
   true → false

9. Magic
   200613 → 200714
```

---

**作成日：2025年10月21日**
**バージョン：v7.00 - バランス改善版**
